<div class="container">
  <h1 id="title-index">Mes trips</h1>

  <%# TABS %>
  <ul class="nav nav-tabs nav-fill trips-tabs" id="myTab" role="tablist" >
    <li class="nav-item trips-tab" role="presentation">
      <div class="nav-link active" id="pending-trips-tab" data-bs-toggle="tab" data-bs-target="#pending-trips" type="button" role="tab" aria-controls="pending-trips" aria-selected="true">En attente</d>
    </li>
    <li class="nav-item trips-tab" role="presentation">
      <div class="nav-link" id="confirmed-trips-tab" data-bs-toggle="tab" data-bs-target="#confirmed-trips" type="button" role="tab" aria-controls="confirmed-trips" aria-selected="false">Confirmés</div>
    </li>
  </ul>

  <div class="tab-content" id="myTabContent">
    <%# PENDING %>
    <div class="tab-pane fade show active" id="pending-trips" role="tabpanel" aria-labelledby="pending-trips-tab" >
      <% @my_pending_trips.each do |trip| %>
        <%# CARDS %>
        <div class="col-md-6 offset-md-2 p-4">
          <div class="card-index-xl-dispo">
            <div class="card-index-xl-img-dispo" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://photos.mandarinoriental.com/is/image/MandarinOriental/paris-2017-home?wid=2880&hei=1280&fmt=jpeg&crop=9,336,2699,1200&anchor=1358,936&qlt=75,0&fit=wrap&op_sharpen=0&resMode=sharp2&op_usm=0,0,0,0&iccEmbed=0&printRes=72')">
              <h5 id="card-index-xl-dispo-title">
                <strong><%= trip.name %></strong>
              </h5>
              <p id="card-index-xl-dispo-date">
                <i class="fas fa-calendar-alt"></i>
                &nbsp<%= I18n.t("date.month_names")[trip.month].capitalize %>
              </p>
              <div class="card-index-xl-dispo-texte">
                <p>Nous attentons encore les <br> disponibilités de vos amis et leurs propositions de destination.</p>
              </div>

              <div class="footer-card-index-xl-dispo">
                <% if trip.user == current_user %>
                  <%= link_to "Booker", new_trip_trip_availability_path(trip), class: "button-grey-xxl " %>
                <% end %>
                <%= link_to "En attente des disponibilités", "#", class: "button-grey-xxl " %>
              </div>
              <div class="container-card-avatar-orange">
                <div class="card-avatar-orange">
                  <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{trip.user.ghname}"), class:"img-card-avatar-orange"  %>
                  <p class="first-name"><%= trip.user.username.capitalize %></p>
                  <div class="check">
                    <i class="fas fa-check"></i>
                  </div>
                </div>
                <% trip.subscriptions.each do |name| %>
                  <% if name.user != trip.user %>
                    <div class="card-avatar-orange">
                      <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{name.user.ghname}"), class:"img-card-avatar-orange"  %>
                      <p class="first-name"><%= name.user.username.capitalize %></p>
                      <div class="check">
                        <i class="fas fa-check"></i>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <% if current_user == trip.user %>
                <div class="link">
                  <i class="fas fa-external-link"></i>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
      <% @my_voting_trips.each do |trip| %>
        <%# CARDS %>
        <div class="col-md-6 offset-md-2 p-4">
          <div class="card-index-xl-vote">
            <div class="card-index-xl-img-vote" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://photos.mandarinoriental.com/is/image/MandarinOriental/paris-2017-home?wid=2880&hei=1280&fmt=jpeg&crop=9,336,2699,1200&anchor=1358,936&qlt=75,0&fit=wrap&op_sharpen=0&resMode=sharp2&op_usm=0,0,0,0&iccEmbed=0&printRes=72')">
              <h5 id="card-index-xl-vote-title">
                <strong><%= trip.name %></strong>
              </h5>
              <p id="card-index-xl-vote-date">
                <i class="fas fa-calendar-alt"></i>
                &nbsp<%= trip.trip_availabilities.first.start_at.strftime('%d/%m/%Y') %> - <%= trip.trip_availabilities.first.end_at.strftime('%d/%m/%Y') %>
              </p>
              <div class="card-index-xl-vote-texte">
                <% if trip.votes.find_by(user: current_user) %>
                  <p>Votre choix a bien été pris en compte, nous attendons juste que vos amis votent aussi pour votre prochaine destination... <br>
                    N’hésitez pas à les secouer un peu !</p>
                <% else %>
                  <p>Dépéchez-vous, vos amis attendent votre vote avec impatience... <br>
                    Vous n’avez pas hâte de connaitre votre future destination ?!</p>
                <% end %>
              </div>
              <div class="footer-card-index-xl-vote">
                <% if trip.votes.find_by(user: current_user) %>
                  <%= link_to "En attente de la destination", "#", class: "button-grey-xxl" %>
                <% else %>
                  <%= link_to "Voter pour la destination !", trip_path(trip), class: "button-blue-xxl" %>
                <% end %>              </div>
              <div class="container-card-avatar-orange">
                <div class="card-avatar-orange">
                  <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{trip.user.ghname}"), class:"img-card-avatar-orange"  %>
                  <p class="first-name"><%= trip.user.username.capitalize %></p>
                  <div class="check">
                    <i class="fas fa-check"></i>
                  </div>
                </div>
                <% trip.subscriptions.each do |name| %>
                  <% if name.user != trip.user %>
                    <div class="card-avatar-orange">
                      <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{name.user.ghname}"), class:"img-card-avatar-orange"  %>
                      <p class="first-name"><%= name.user.username.capitalize %></p>
                      <div class="check">
                        <i class="fas fa-check"></i>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <% if current_user == trip.user %>
                <div class="link">
                  <i class="fas fa-external-link"></i>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
      <%# CARTE POUR LES TRIPS CONFIRMES MAIS L'USER N'A PAS ENCORE ACCEPTE %>
      <% @my_confirmed_trips.each do |trip| %>
        <% if Subscription.find_by(user: current_user, trip: trip).status == "pending" %>
          <%# CARDS %>
          <div class="col-md-6 offset-md-2 p-4">
            <div class="card-index-xl">
              <div class="card-index-xl-img" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://photos.mandarinoriental.com/is/image/MandarinOriental/paris-2017-home?wid=2880&hei=1280&fmt=jpeg&crop=9,336,2699,1200&anchor=1358,936&qlt=75,0&fit=wrap&op_sharpen=0&resMode=sharp2&op_usm=0,0,0,0&iccEmbed=0&printRes=72')">
                <h5 id="card-index-title">
                  <strong><%= trip.name %></strong>
                </h5>
                <p id="card-index-date">
                  <i class="fas fa-calendar-alt"></i>
                  &nbsp<%= trip.trip_availabilities.first.start_at.strftime('%d/%m/%Y') %> - <%= trip.trip_availabilities.first.end_at.strftime('%d/%m/%Y') %>
                </p>
                <div class="card-index-texte">
                  <p>Découvrez la ville choisie par vous et vos amis puis confirmez votre présence. <br>
                      Vous pourrez ensuite accéder au tableau de bord de votre futur voyage et vous organiser comme des chefs !</p>
                </div>
                <div class="footer-card-index-xl">
                  <div class="button-orange-xxl" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal<%= trip.id %>" class="w3-button">Découvrir la destination !</div>
                </div>
                <div class="container-card-avatar-orange">
                  <div class="card-avatar-orange">
                    <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{trip.user.ghname}"), class:"img-card-avatar-orange"  %>
                    <p class="first-name"><%= trip.user.username.capitalize %></p>
                    <div class="check">
                      <i class="fas fa-check"></i>
                    </div>
                  </div>
                  <% trip.subscriptions.each do |name| %>
                    <% if name.user != trip.user %>
                      <div class="card-avatar-orange">
                        <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{name.user.ghname}"), class:"img-card-avatar-orange"  %>
                        <p class="first-name"><%= name.user.username.capitalize %></p>
                        <div class="check">
                          <i class="fas fa-check"></i>
                        </div>
                      </div>
                    <% end %>
                  <% end %>
              </div>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <%# CONFIRMED %>
    <div class="tab-pane fade" id="confirmed-trips" role="tabpanel" aria-labelledby="confirmed-trips-tab"  >
      <div class="container-trips">
        <div class="cards-grid-wrapper">
          <% @my_confirmed_trips.each do |trip| %>
            <%# CARDS %>
            <%= link_to trip_path(trip) do %>
              <div class="col-sm-6 p-4">
                <div class="card-index">
                  <div class="card-index-img" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= cl_image_path trip.place_proposal.place.photo.key, crop: :fill, height: 400 %>')">
                    <h5 id="card-index-title"><strong><%= trip.place_proposal.place.city.upcase %></strong></h5>
                    <p id="card-index-texte"><%= trip.name %></p>
                    <p id="card-index-date">
                      <i class="fas fa-calendar-alt"></i>
                      &nbsp<%= trip.trip_availabilities.first.start_at.strftime('%d/%m/%Y') %> - <%= trip.trip_availabilities.first.end_at.strftime('%d/%m/%Y') %>
                    </p>
                    <div class="container-mini-avatar">
                      <div class="card-index-footer">
                        <div class="mini-avatar">
                          <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{trip.user.ghname}"), class:"mini-avatar-img"  %>
                        </div>
                      </div>
                      <% trip.subscriptions.each do |name| %>
                        <% if trip.user != name.user %>
                          <div class="card-index-footer">
                            <div class="mini-avatar">
                              <%= image_tag image_url("https://kitt.lewagon.com/placeholder/users/#{name.user.ghname}"), class:"mini-avatar-img"  %>
                            </div>
                          </div>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
            <div class="footer-card-index-xl">
              <div class="button-orange-xxl" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal<%= trip.id %>" class="w3-button">Découvrir la destination !</div>
            </div>
          <% end %>
        </div>
        <%# MAP %>
        <div id="map" style="width: 30vw; height: 100vh;"
          data-controller="mapbox"
          data-mapbox-markers-value="<%= @markers.to_json %>"
          data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
      </div>
    </div>
  </div>
</div>

<% @my_confirmed_trips.each do |trip| %>
  <%= render "shared/result", trip: trip %>
<% end %>
